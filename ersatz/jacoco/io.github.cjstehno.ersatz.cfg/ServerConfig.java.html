<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ServerConfig.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ersatz</a> &gt; <a href="index.source.html" class="el_package">io.github.cjstehno.ersatz.cfg</a> &gt; <span class="el_source">ServerConfig.java</span></div><h1>ServerConfig.java</h1><pre class="source lang-java linenums">/**
 * Copyright (C) 2023 Christopher J. Stehno
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package io.github.cjstehno.ersatz.cfg;

import io.github.cjstehno.ersatz.encdec.DecodingContext;

import java.net.URL;
import java.util.concurrent.TimeUnit;
import java.util.function.BiFunction;
import java.util.function.Consumer;
import java.util.function.Function;

import static java.util.concurrent.TimeUnit.SECONDS;

/**
 * Configuration interface for an Ersatz server instance.
 */
public interface ServerConfig {

    /**
     * Used to control the enabled/disabled state of HTTPS on the server. By default HTTPS is disabled.
     *
     * @param enabled whether or not HTTPS support is enabled
     * @return a reference to the server being configured
     */
    ServerConfig https(boolean enabled);

    /**
     * Used to enabled HTTPS on the server. By default HTTPS is disabled.
     *
     * @return a reference to the server being configured
     */
    ServerConfig https();

    /**
     * Used to enable/disable the auto-start feature, which will start the server after any call to either of the &lt;code&gt;expectations&lt;/code&gt;
     * configuration methods. With this setting enabled, any other calls to the &lt;code&gt;start()&lt;/code&gt; method are ignored. Further configuration is
     * allowed.
     * &lt;p&gt;
     * Auto-start is enabled by default.
     *
     * @param enabled whether or not auto-start is enabled
     * @return a reference to the server being configured
     */
    ServerConfig autoStart(boolean enabled);

    /**
     * Used to specify the server request timeout property value on the server.
     *
     * @param value the timeout value
     * @param units the units the timeout is specified with
     * @return a reference to the server being configured
     */
    ServerConfig timeout(int value, TimeUnit units);

    /**
     * Used to specify the server request timeout property value on the server, in seconds.
     *
     * @param value the timeout value
     * @return a reference to the server being configured
     */
    default ServerConfig timeout(int value) {
<span class="fc" id="L76">        return timeout(value, SECONDS);</span>
    }

    /**
     * Causes the mismatched request reports to be generated as console output, rather than only in the logging.
     *
     * @return a reference to the server being configured
     */
    default ServerConfig reportToConsole() {
<span class="fc" id="L85">        return reportToConsole(true);</span>
    }

    /**
     * Used to toggle the console output of mismatched request reports. By default they are only rendered in the logging. A value of &lt;code&gt;true&lt;/code&gt;
     * will cause the report to be output on the console as well.
     *
     * @param toConsole whether or not the report should also be written to the console
     * @return a reference to the server being configured
     */
    ServerConfig reportToConsole(boolean toConsole);

    /**
     * Allows configuration of an external HTTPS keystore with the given location and password. By default, if this is not specified an internally
     * provided keystore will be used for HTTPS certification. See the User Guide for details about configuring your own keystore.
     *
     * @param location the URL of the keystore file
     * @param password the keystore file password
     * @return a reference to the server being configured
     */
    ServerConfig keystore(URL location, String password);

    /**
     * Allows configuration of an external HTTPS keystore with the given location (using the default password &quot;ersatz&quot;). By default, if this is not
     * specified an internally provided keystore will be used for HTTPS certification. See the User Guide for details about configuring your own
     * keystore.
     *
     * @param location the URL of the keystore file
     * @return a reference to the server being configured
     */
    ServerConfig keystore(URL location);

    /**
     * Used to configure HTTP expectations on the server; the provided &lt;code&gt;Consumer&amp;lt;Expectations&amp;gt;&lt;/code&gt; implementation will have an active
     * &lt;code&gt;Expectations&lt;/code&gt; object passed into it for configuring server interaction expectations.
     *
     * If auto-start is enabled (default) the server will be started after the expectations are applied.
     *
     * @param expects the &lt;code&gt;Consumer&amp;lt;Expectations&amp;gt;&lt;/code&gt; instance to perform the configuration
     * @return a reference to this server
     */
    ServerConfig expectations(Consumer&lt;Expectations&gt; expects);

    /**
     * An alternate means of starting the expectation chain.
     *
     * @return the reference to the Expectation configuration object
     */
    Expectations expects();

    /**
     * Configures the given request content decoder for the specified request content-type. The decoder will be configured globally and used if no
     * overriding decoder is provided during expectation configuration.
     *
     * @param contentType the request content-type
     * @param decoder     the request content decoder
     * @return the reference to the server configuration
     */
    ServerConfig decoder(String contentType, BiFunction&lt;byte[], DecodingContext, Object&gt; decoder);

    /**
     * Configures the given request content decoder for the specified request content-type. The decoder will be configured globally and used if no
     * overriding decoder is provided during expectation configuration.
     *
     * @param contentType the request content-type
     * @param decoder     the request content decoder
     * @return the reference to the server configuration
     */
    default ServerConfig decoder(final ContentType contentType, final BiFunction&lt;byte[], DecodingContext, Object&gt; decoder) {
<span class="fc" id="L154">        return decoder(contentType.getValue(), decoder);</span>
    }

    /**
     * Registers a global response body encoder.
     * &lt;p&gt;
     * param contentType the response content-type to be encoded
     *
     * @param contentType the response content type to be encoded
     * @param objectType the response object type to be encoded
     * @param encoder    the encoder function
     * @return a reference to this server configuration
     */
    ServerConfig encoder(String contentType, Class objectType, Function&lt;Object, byte[]&gt; encoder);

    /**
     * Registers a global response body encoder.
     * &lt;p&gt;
     * param contentType the response content-type to be encoded
     *
     * @param contentType the response content type to be encoded
     * @param objectType the response object type to be encoded
     * @param encoder    the encoder function
     * @return a reference to this server configuration
     */
    default ServerConfig encoder(ContentType contentType, Class objectType, Function&lt;Object, byte[]&gt; encoder) {
<span class="fc" id="L180">        return encoder(contentType.getValue(), objectType, encoder);</span>
    }

    /**
     * Allows the specific configuration of the HTTP server port. The default ephemeral port should be used in most cases since
     * specifying the port will negate the ability to run tests in parallel and will also allow possible collisions with
     * other running servers on the host.
     * &lt;p&gt;
     * Do NOT specify this setting unless you really need to.
     *
     * @param value the desired HTTP port
     * @return a reference to this server configuration
     */
    ServerConfig httpPort(int value);

    /**
     * Allows the specific configuration of the HTTPS server port. The default ephemeral port should be used in most cases since
     * specifying the port will negate the ability to run tests in parallel and will also allow possible collisions with
     * other running servers on the host.
     * &lt;p&gt;
     * Do NOT specify this setting unless you really need to.
     *
     * @param value the desired HTTPS port
     * @return a reference to this server configuration
     */
    ServerConfig httpsPort(int value);

    /**
     * Causes the full response content to be rendered in the server log message (if true) for the cases where the
     * response content is a renderable textual response. If false (or binary response) only the number of bytes and
     * content type will be rendered for the response.
     *
     * @param value whether or not to enable logging of response content (false by default)
     * @return a reference to this server configuration.
     */
    ServerConfig logResponseContent(boolean value);

    /**
     * Causes the full response content to be rendered in the server log message for the cases where the response
     * content is a renderable textual response. If false (or binary response) only the number of bytes and content type
     * will be rendered for the response.
     *
     * @return a reference to this server configuration.
     */
    default ServerConfig logResponseContent() {
<span class="fc" id="L225">        return logResponseContent(true);</span>
    }

    /**
     * Allows the configuration of the number of IO and Worker threads to be used by the underlying server.
     *
     * @param io the number of IO threads (should be fewer than workers; default is 2)
     * @param worker the number of worker threads (should be more than io; default is 16)
     * @return a reference to this server configuration
     */
    ServerConfig serverThreads(int io, int worker);

    /**
     * Allows the configuration of the number of IO threads to be used by the underlying server. The worker threads will
     * be configured to 8 times the configured io number.
     *
     * @param io the number of IO threads (should be a small number; default is 2)
     * @return a reference to this server configuration
     */
    @SuppressWarnings(&quot;checkstyle:MagicNumber&quot;)
    default ServerConfig serverThreads(final int io) {
<span class="fc" id="L246">        return serverThreads(io, io * 8);</span>
    }

    /**
     * Allows the configuration of any global request requirements.
     *
     * @param requirements the requirements configuration consumer
     * @return a reference to this server configuration
     */
    ServerConfig requirements(Consumer&lt;Requirements&gt; requirements);
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>